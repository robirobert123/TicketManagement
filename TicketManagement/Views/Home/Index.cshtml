@model TicketManagement.Models.DashboardModel

@{
    ViewBag.Title = "Ticket Dashboard";
}

<div class="dashboard-wrapper">
    <div class="search-bar-wrapper">
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Search tickets...">
            <button id="search-button" class="btn-search">Search</button>
        </div>
        <div class="filter-dropdown">
            <span>Filter by:</span>
            <select id="filter-status" class="filter-select">
                <option value="all">All Statuses</option>
                @foreach (var status in Model.Statuses)
                {
                    <option value="@status.StatusID">@status.StatusName</option>
                }
            </select>
        </div>
    </div>

    <div class="status-cards">
        <div class="status-card todo">
            <div class="status-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <div class="status-name">To Do</div>
            <div class="status-count">@Model.TicketDetails.Count(t => t.StatusText == "To Do" || t.StatusText == "Open")</div>
        </div>
        
        <div class="status-card in-progress">
            <div class="status-icon">
                <i class="fas fa-spinner"></i>
            </div>
            <div class="status-name">In Progress</div>
            <div class="status-count">@Model.TicketDetails.Count(t => t.StatusText == "In Progress")</div>
        </div>
        
        <div class="status-card testing">
            <div class="status-icon">
                <i class="fas fa-vial"></i>
            </div>
            <div class="status-name">Testing</div>
            <div class="status-count">@Model.TicketDetails.Count(t => t.StatusText == "Testing")</div>
        </div>
        
        <div class="status-card done">
            <div class="status-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="status-name">Done</div>
            <div class="status-count">@Model.TicketDetails.Count(t => t.StatusText == "Closed" || t.StatusText == "Done")</div>
        </div>
    </div>

    <div class="board-container">
        <div class="board-column">
            <div class="column-header">
                <h2>To Do</h2>
                <span class="ticket-count">@Model.TicketDetails.Count(t => t.StatusText == "To Do" || t.StatusText == "Open")</span>
            </div>
            <div class="column-content">
                @foreach (var ticket in Model.TicketDetails.Where(t => t.StatusText == "To Do" || t.StatusText == "Open"))
                {
                    <div class="ticket-card" data-id="@ticket.TicketID">
                        <div class="ticket-header">
                            <h3 class="ticket-title">@ticket.Title</h3>
                            <span class="ticket-id">#@ticket.TicketID</span>
                        </div>
                        <div class="ticket-meta">
                            <div class="ticket-priority @ticket.PriorityText.ToLower()">
                                <span>@ticket.PriorityText</span>
                            </div>
                            <div class="ticket-category">
                                <span>@ticket.CategoryText</span>
                            </div>
                        </div>
                        <div class="ticket-assignee">
                            <div class="avatar">
                                @if (!string.IsNullOrEmpty(ticket.AssigneeName))
                                {
                                    @ticket.AssigneeName.Substring(0, 1)
                                }
                                else
                                {
                                    <i class="fas fa-user"></i>
                                }
                            </div>
                            <span>@(string.IsNullOrEmpty(ticket.AssigneeName) ? "Unassigned" : ticket.AssigneeName)</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="board-column">
            <div class="column-header">
                <h2>In Progress</h2>
                <span class="ticket-count">@Model.TicketDetails.Count(t => t.StatusText == "In Progress")</span>
            </div>
            <div class="column-content">
                @foreach (var ticket in Model.TicketDetails.Where(t => t.StatusText == "In Progress"))
                {
                    <div class="ticket-card" data-id="@ticket.TicketID">
                        <div class="ticket-header">
                            <h3 class="ticket-title">@ticket.Title</h3>
                            <span class="ticket-id">#@ticket.TicketID</span>
                        </div>
                        <div class="ticket-meta">
                            <div class="ticket-priority @ticket.PriorityText.ToLower()">
                                <span>@ticket.PriorityText</span>
                            </div>
                            <div class="ticket-category">
                                <span>@ticket.CategoryText</span>
                            </div>
                        </div>
                        <div class="ticket-assignee">
                            <div class="avatar">
                                @if (!string.IsNullOrEmpty(ticket.AssigneeName))
                                {
                                    @ticket.AssigneeName.Substring(0, 1)
                                }
                                else
                                {
                                    <i class="fas fa-user"></i>
                                }
                            </div>
                            <span>@(string.IsNullOrEmpty(ticket.AssigneeName) ? "Unassigned" : ticket.AssigneeName)</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="board-column">
            <div class="column-header">
                <h2>Testing</h2>
                <span class="ticket-count">@Model.TicketDetails.Count(t => t.StatusText == "Testing")</span>
            </div>
            <div class="column-content">
                @foreach (var ticket in Model.TicketDetails.Where(t => t.StatusText == "Testing"))
                {
                    <div class="ticket-card" data-id="@ticket.TicketID">
                        <div class="ticket-header">
                            <h3 class="ticket-title">@ticket.Title</h3>
                            <span class="ticket-id">#@ticket.TicketID</span>
                        </div>
                        <div class="ticket-meta">
                            <div class="ticket-priority @ticket.PriorityText.ToLower()">
                                <span>@ticket.PriorityText</span>
                            </div>
                            <div class="ticket-category">
                                <span>@ticket.CategoryText</span>
                            </div>
                        </div>
                        <div class="ticket-assignee">
                            <div class="avatar">
                                @if (!string.IsNullOrEmpty(ticket.AssigneeName))
                                {
                                    @ticket.AssigneeName.Substring(0, 1)
                                }
                                else
                                {
                                    <i class="fas fa-user"></i>
                                }
                            </div>
                            <span>@(string.IsNullOrEmpty(ticket.AssigneeName) ? "Unassigned" : ticket.AssigneeName)</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="board-column">
            <div class="column-header">
                <h2>Closed</h2>
                <span class="ticket-count">@Model.TicketDetails.Count(t => t.StatusText == "Closed" || t.StatusText == "Done")</span>
            </div>
            <div class="column-content">
                @foreach (var ticket in Model.TicketDetails.Where(t => t.StatusText == "Closed" || t.StatusText == "Done"))
                {
                    <div class="ticket-card" data-id="@ticket.TicketID">
                        <div class="ticket-header">
                            <h3 class="ticket-title">@ticket.Title</h3>
                            <span class="ticket-id">#@ticket.TicketID</span>
                        </div>
                        <div class="ticket-meta">
                            <div class="ticket-priority @ticket.PriorityText.ToLower()">
                                <span>@ticket.PriorityText</span>
                            </div>
                            <div class="ticket-category">
                                <span>@ticket.CategoryText</span>
                            </div>
                        </div>
                        <div class="ticket-assignee">
                            <div class="avatar">
                                @if (!string.IsNullOrEmpty(ticket.AssigneeName))
                                {
                                    @ticket.AssigneeName.Substring(0, 1)
                                }
                                else
                                {
                                    <i class="fas fa-user"></i>
                                }
                            </div>
                            <span>@(string.IsNullOrEmpty(ticket.AssigneeName) ? "Unassigned" : ticket.AssigneeName)</span>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <a href="@Url.Action("Create", "Ticket")" class="btn-create-ticket">
        <i class="fas fa-plus"></i>
    </a>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Search functionality
            $("#search-button").click(function() {
                const searchTerm = $("#search-input").val().toLowerCase();
                
                if (searchTerm === '') {
                    $(".ticket-card").show();
                    return;
                }
                
                $(".ticket-card").each(function() {
                    const title = $(this).find(".ticket-title").text().toLowerCase();
                    
                    if (title.includes(searchTerm)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
            
            // Status filter
            $("#filter-status").change(function() {
                const selectedStatus = $(this).val();
                
                if (selectedStatus === 'all') {
                    $(".board-column").show();
                    return;
                }
                
                $(".board-column").each(function(index) {
                    if (index + 1 == selectedStatus) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
            
            // Make ticket cards clickable
            $(".ticket-card").click(function() {
                const ticketId = $(this).data("id");
                window.location.href = '@Url.Action("Details", "Ticket")/' + ticketId;
            });
        });
    </script>
    }
}
